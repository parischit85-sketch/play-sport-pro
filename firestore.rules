// Firebase Firestore Security Rules
// Versione permissiva per sviluppo - da restringere in produzione

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Regole specifiche per collezioni principali

    // Profili: solo il proprietario pu√≤ leggere/scrivere il proprio profilo
    match /profiles/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Prenotazioni: lettura per autenticati; scrittura solo dall'autore
    match /bookings/{bookingId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.createdBy;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.createdBy;
    }

    // Leghe: lettura per autenticati; scrittura riservata agli admin del documento
    match /leagues/{leagueId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && (request.auth.token.admin == true || request.auth.uid in resource.data.admins);
    }

    // Dati condivisi generici (config pubbliche per utenti autenticati)
    match /shared/{document=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }

    // Backups: lettura per autenticati; scrittura solo da admin
    match /backups/{backupId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }

    // Diagnostica: consentito a utenti autenticati
    match /diagnostics/{document=**} {
      allow read, write: if request.auth != null;
    }

    // Blocca tutto il resto per default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
