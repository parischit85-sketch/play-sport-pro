# üîß Configurazione Netlify per Push Notifications

## Variabili d'Ambiente da Configurare

Vai su: **Netlify Dashboard** ‚Üí **Il tuo sito** ‚Üí **Site settings** ‚Üí **Environment variables**

### 1. VAPID Keys (per Web Push)

```bash
VAPID_PUBLIC_KEY=BLgzoWZyeroUOSQ_qCFGfD-Y1PTkM809QTxc85X9oiHFKLovhxCpTgpAQV8zX6iJwLKy_wmMEQx7HHZUKrXusdM
VAPID_PRIVATE_KEY=I-rY8mHqxKzGnDo5_EqT7jPpVHxGBpfWvLJhMxCqf7I
```

### 2. Firebase Admin Credentials

Questi valori li trovi in Firebase Console ‚Üí Project Settings ‚Üí Service Accounts:

```bash
FIREBASE_PROJECT_ID=<il-tuo-project-id>
FIREBASE_CLIENT_EMAIL=<service-account-email>
FIREBASE_PRIVATE_KEY=<private-key-con-\n-escaped>
```

‚ö†Ô∏è **IMPORTANTE per FIREBASE_PRIVATE_KEY**:
- La chiave privata contiene caratteri `\n` (newline)
- Su Netlify, devi **escapare** i `\n` come `\\n`
- Esempio: `"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBA...\\n-----END PRIVATE KEY-----\\n"`

## üìã Checklist

- [ ] Aggiungi VAPID_PUBLIC_KEY
- [ ] Aggiungi VAPID_PRIVATE_KEY
- [ ] Aggiungi FIREBASE_PROJECT_ID
- [ ] Aggiungi FIREBASE_CLIENT_EMAIL
- [ ] Aggiungi FIREBASE_PRIVATE_KEY (con \\n escaped)
- [ ] Redeploy del sito (Netlify redeploya automaticamente dopo modifica env vars)

## üß™ Test dopo il Deploy

1. Vai su `/profile` nell'app
2. Clicca "Diagnostica server push"
3. Verifica che tutti i check siano ‚úÖ verdi
4. Iscriviti alle notifiche push
5. Invia una notifica di test

## üîç Come Ottenere le Credenziali Firebase

### Project ID
Firebase Console ‚Üí Project Settings ‚Üí General ‚Üí Project ID

### Service Account Email e Private Key
1. Firebase Console ‚Üí Project Settings ‚Üí Service Accounts
2. Clicca "Generate new private key"
3. Scarica il file JSON
4. Prendi i valori:
   - `client_email` ‚Üí FIREBASE_CLIENT_EMAIL
   - `private_key` ‚Üí FIREBASE_PRIVATE_KEY (ricorda di escapare \n come \\n)
   - `project_id` ‚Üí FIREBASE_PROJECT_ID

## üìù Esempio File JSON Firebase

```json
{
  "type": "service_account",
  "project_id": "play-sport-pro",
  "private_key_id": "...",
  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBA...\n-----END PRIVATE KEY-----\n",
  "client_email": "firebase-adminsdk-xxxxx@play-sport-pro.iam.gserviceaccount.com",
  "client_id": "...",
  "auth_uri": "...",
  "token_uri": "...",
  "auth_provider_x509_cert_url": "...",
  "client_x509_cert_url": "..."
}
```

## üöÄ Deploy Automatico

Netlify rifar√† automaticamente il deploy quando modifichi le environment variables.
Aspetta che il deploy sia completo prima di testare.

## ‚ùå Troubleshooting

### "Firebase Admin: failed"
- Verifica che FIREBASE_PRIVATE_KEY abbia `\\n` e non solo `\n`
- Verifica che la chiave inizi con `-----BEGIN PRIVATE KEY-----`
- Assicurati che client_email e project_id siano corretti

### "allConfigured: false"
- Una o pi√π variabili d'ambiente mancano
- Controlla i nomi esatti (case-sensitive)
- Verifica che non ci siano spazi extra

### Push non ricevute
- Controlla che il service worker sia registrato (`/sw.js`)
- Verifica i permessi del browser per le notifiche
- Controlla la console browser per errori
